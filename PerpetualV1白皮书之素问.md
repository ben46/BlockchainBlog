# Perpetual v1 白皮书之素问

白皮书地址: https://www.notion.so/Strike-Protocol-9049cc65e99246d886a230972d0cbd60

名词定义: 
* strike: perp v1的原名(原名叫Strike Protocol)
* ske = strike native erc20 tokens = 平台原生币
* ske holder = 平台原生币持有者

# 2-1 质押流动性
- 需要做什么:
- - 流动性提供者可以质押ske和dai实现amm挖矿

- 为什么要质押双币?
- - 确保AMM有足够的抵押品支持

- 能获得什么: 
 - - 质押奖励+一部分手续费收入, 风险是保险基金赔付的损失
 - 还有一部分amm利润去哪了
 - - Strike’s Insurance Fund
- Strike’s Insurance Fund是干嘛的
- - 行情剧烈波动,平仓后穿仓的损失
![image](https://user-images.githubusercontent.com/1460432/205475216-9f646f74-70b7-4389-90ff-583df7227a5e.png)

- 我很有钱, 我想投, 我应该怎么做呢
- - 先用erc20和稳定币两个搭配, 换取平台基金
- - 收到平台基金
- - 质押到流动储备(也就是保险基金)
- 几天后可以取出我的基金
- - 7天
- 如果Strike’s Insurance Fund不够了会怎么样
- - 那么reserve池子里面的平台基金将会被提取, 来充实insurance fund
- 怎么充实呢, 基金是一种平台币
- - 先把基金提取到balancer fund, 来换取足够的稳定币, 用稳定币来充实insurance fund, 来保证amm

## 2.2 amm-based衍生品
- 每个币种的合约amm池子是分开的吗
- - 是的, 但是中央流动性准备金是共享的
- 听说你们还有掉期期货?
- - 是的,掉期期货相当于永续合约在固定的时间清算,比如3月掉期合约, 就会在3月末自动平仓
- 平仓后是现金结算吗
- - 是的,而且我们还有永续合约
- 假设这个期货掉期合约过期了,那么新发一个,初始价格怎么约定
- - 我们会从预言机拿一个60分钟的时间加权均价
## 2.3 通过amm交易
- 你们的合约价格如何计算
- - x * y = k
- 有点差吗?
- - 为了保证amm的损失,可以从点差和insurance fund里面补偿
- 做多做空的人需要付利息吗?
- - 如果合约交易价格>预言机价格,那么做多的人要付钱给做空的人
- 这个费用多久结算一次
- - 1小时
```
Premium = Mark Price - Index Price
资金费率 = Premium / Index Price = (Mark - Index) / Index
```
- 我是trader, 我想在你们平台交易, 我应该怎么做
- - 把代币存入clearing house
- - 存入的必须是我们指定的基础资产(amm池子里的)
- - 默认的基础资产是DAI
- 我爆仓了怎么清算
- - 当保证金比例下降到 6.25%或以下时，就会发生清算，这一规则即维持保证金（Maintenance Margin）。 清算由清算人的机器人出发，作为清算的奖励，清算人获得 6.25%保证金中的 1.25%，其余最高 5%保证金存入协议保险基金。perp使用部分清算方案：假设及时平仓，只会将25%的仓位盈亏将变现，相应部分的名义仓位以及保证金将被平掉，剩余仓位保持不变。
- 假如我有500个DAI, 我想开ETHDAI永续合约多单, 步骤如何
- - Clearing House会查看你有没有500个dai
- - Clearing House调用amm的交易函数, 把500个dai在amm里记账, 来交易ethdai.  
- - 假设这里有amm池子里有20000个dai,和100个ethdai(报价资产), 根据公式计算曲线和价差, 500个dai可以交易为2.4390个ethdai
- - Clearing House收到了上述的ethdai之后, 你的仓位将会被更新
- - amm的总头寸将会被更新为20500dai和97.56个ethdai
![image](https://user-images.githubusercontent.com/1460432/205477524-b6c76c17-c2df-4c57-b569-cf7d8b5be07b.png)
## 2.3.3平仓
![image](https://user-images.githubusercontent.com/1460432/205477682-adb2f200-0740-4f5b-9215-61484573c89c.png)
## 3 ske代币(平台原生代币)
- 谁发行的
- - strike dao
- 总供应量有限制吗
- - 没有
- 用途呢?
- - 可以和dai一起质押给流动性储备, 来给amm提供流动性
- 有什么激励措施
- - 4年里面, 每年的质押挖矿数量递减.公式自己去查吧
- 那我挖到的币, 能直接卖掉吗?
- - 不能质押挖矿得到的比, 一年内不能转让
## 风险
 - 如果流动性流动性reserve不够弥补amm的损失咋办
 ```
 抵押率是一个可以通过治理重新更改的. 
 - - 流动性储备价值 = 平台基金数量 * 平台基金的价格 + 保险基金的价值
 - - cratio = 流动性储备价值 / amm中的P&L
 - - 打个比方, 流动性储备要求c比值是500%
 - - 流动储备价值现在 = 10,0000dai
 - - ethdai在amm的初始价格是200dai
 - - 假设AMM的未实现损失在一系列交易后达到10000 DAI，则当前的C比率为1000%。
 - - 如果未实现损失继续增长并达到20000 DAI，C比率将降至所需C比率（500%）。
 - - 一旦发生这种情况，AMM将停止进一步交易（多头或空头头寸取决于损失），以防止未实现损失的增加。也就是margin call...悲剧了
 ```
 - 这么说, 万一池子里的散户超牛逼, 都赌对了,那么, 池子就爆仓了对吗
 - - 是的
 - 怎么解决这个问题
 - - 找投资人继续往里面投钱, 只要池子无限大, 就不存在亏钱的可能, 可以和散户无限对赌

## 紧急关停

- 假设禁止散户开单了, 但是我们的流动性储备的价值一直往下缩水咋办?
- - 关闭Strike协议, 所有潜在抵押品可供其所有者赎回的过程. 该条件需要社区投票激活, 投票条件如下
```
1.至少有一份正在进行的期货合约。
2.*流动性准备金*的*C比率*低于150%。
```


